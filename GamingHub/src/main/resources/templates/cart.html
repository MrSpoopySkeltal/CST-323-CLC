<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GameHub • Cart / Checkout</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0c0f1a; --bg2:#12172a; --text:#e8eefc; --muted:#9fb0c9; --card:#151b31; --outline:#2f3a5a; --accentA:#ff7a7a; --accentB:#49d3c3; }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--text);
        background: radial-gradient(1200px 800px at 20% -10%, #1a2241 0%, transparent 60%),
                   radial-gradient(900px 700px at 95% 30%, #152045 0%, transparent 55%),
                   linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%); }
  .nav{ position:sticky; top:0; z-index:20; backdrop-filter: blur(10px);
        background: linear-gradient(180deg, rgba(12,15,26,.9), rgba(12,15,26,.65));
        border-bottom:1px solid #1f2743; }
  .nav-inner{ max-width:1120px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:14px 18px; }
  .brand{ font-weight:900; letter-spacing:.4px; font-size:26px; background:linear-gradient(90deg, var(--accentA), var(--accentB));
          -webkit-background-clip:text; background-clip:text; color:transparent; animation:pulse 2.6s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.02)} }
  .nav-links a{ color:#9fb0c9; text-decoration:none; margin-left:22px; font-weight:600; font-size:14px }
  .nav-links a:hover{ color:var(--text) }

  .wrap{ max-width:1120px; margin:42px auto 60px; padding:0 18px; }
  .title{ font-size: clamp(32px, 5vw, 56px); font-weight:900; text-align:center;
          background:linear-gradient(90deg, var(--accentA), var(--accentB));
          -webkit-background-clip:text; background-clip:text; color:transparent; margin:10px 0 8px; }
  .sub{ color:var(--muted); text-align:center; margin-bottom:24px }
  .breadcrumb{ color:#9fb0c9; margin-bottom:10px; }

  /* Stepper */
  .stepper{ display:grid; grid-template-columns: repeat(4,1fr); gap:8px; margin:14px 0 24px; }
  .step{ text-align:center; padding:10px; border:1px solid var(--outline); border-radius:10px; background:#121a32; color:#9fb0c9; font-weight:700; font-size:13px; }
  .step.active{ color:#0b1227; background:linear-gradient(90deg, var(--accentA), var(--accentB)); border-color:transparent; }

  .card{ background: linear-gradient(180deg, #151b31, #131833); border:1px solid var(--outline); border-radius:16px; overflow:hidden }
  .pad{ padding:16px }
  .row{ display:grid; grid-template-columns: 1fr 320px; gap:18px }
  .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:12px }
  label{ color:#c7d3ee; font-weight:700; font-size:12px; letter-spacing:.4px; text-transform:uppercase }
  input, select, textarea{ width:100%; background:#0e1429; color:var(--text); border:1px solid #2a3557; border-radius:10px; padding:10px 12px; outline:none; }
  .muted{ color:#9fb0c9 }
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; cursor:pointer; border:none; border-radius:999px; padding:12px 16px; font-weight:800; }
  .btn-primary{ background:linear-gradient(90deg, var(--accentA), var(--accentB)); color:#0b1227; }
  .btn-ghost{ background:transparent; color:#e8eefc; border:1px solid var(--outline); }
  .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px }

  table{ width:100%; border-collapse:collapse; }
  th, td{ text-align:left; padding:10px; border-bottom:1px solid #2a3557 }
  th{ color:#c7d3ee; font-size:12px; letter-spacing:.4px; text-transform:uppercase }
  .right{ text-align:right }
  .totals{ margin-top:10px }
  .totals div{ display:flex; justify-content:space-between; margin:6px 0 }
  .ok{ color:#49d3c3; }
</style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <a class="brand" th:href="@{/}">GameHub</a>
      <nav class="nav-links">
        <a th:href="@{/}">Home</a>
        <a th:href="@{/products}">Games</a>
        <a th:href="@{/about}">About</a>
        <a th:href="@{/cart}">Cart <span id="cartCount" th:text="${cartCount} ?: 0">0</span></a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <nav class="breadcrumb"><a th:href="@{/}" style="color:#9fb0c9;text-decoration:none">Home</a> › Cart / Checkout</nav>
    <h1 class="title">Checkout</h1>
    <p class="sub">Review items, fill your details, choose payment, and confirm your order</p>

    <div class="stepper">
      <div class="step" data-step="1">1. Review</div>
      <div class="step" data-step="2">2. User Info</div>
      <div class="step" data-step="3">3. Payment</div>
      <div class="step" data-step="4">4. Confirmation</div>
    </div>

    <div class="row">
      <!-- Left: content -->
      <section class="card" id="panel">
        <!-- Panels rendered by JS; server-side fallback example below -->
        <div class="pad" id="panelInner">
          <!-- Fallback Review (SSR sample) -->
          <h2 style="margin:0 0 8px">Order Review</h2>
          <table>
            <thead><tr><th>Item</th><th>Platform</th><th class="right">Qty</th><th class="right">Price</th></tr></thead>
            <tbody>
              <tr th:each="item: ${cart?.items}">
                <td th:text="${item.name}">Cyber Quest 2024</td>
                <td th:text="${item.platform}">PC</td>
                <td class="right" th:text="${item.qty}">1</td>
                <td class="right" th:text="${#numbers.formatDecimal(item.price,1,'COMMA',2,'POINT')}">$59.99</td>
              </tr>
              <tr th:if="${cart == null}">
                <td>Sample Item</td><td>PC</td><td class="right">1</td><td class="right">$59.99</td>
              </tr>
            </tbody>
          </table>
          <div class="actions">
            <button class="btn btn-primary" id="toUser">Next: User Info</button>
          </div>
        </div>
      </section>

      <!-- Right: summary -->
      <aside class="card">
        <div class="pad">
          <h3 style="margin:0 0 10px">Order Summary</h3>
          <div class="totals">
            <div><span>Subtotal</span><strong id="subtotal" th:text="${cart?.subtotal} ?: '$59.99'">$59.99</strong></div>
            <div><span>Tax</span><strong id="tax" th:text="${cart?.tax} ?: '$4.80'">$4.80</strong></div>
            <div><span>Shipping</span><strong id="ship" th:text="${cart?.shipping} ?: '$0.00'">$0.00</strong></div>
            <div><span>Total</span><strong id="total" th:text="${cart?.total} ?: '$64.79'">$64.79</strong></div>
          </div>
          <p class="muted" style="margin-top:10px">Secure checkout with encrypted payment.</p>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // --- Simple stepper + demo cart (replace with real MVC model later) ---
    const steps = Array.from(document.querySelectorAll('.step'));
    let current = 1;

    const demoCart = JSON.parse(localStorage.getItem('cart') || '[]');
    const hasCart = demoCart.length > 0;

    function setActive(){
      steps.forEach(s => s.classList.toggle('active', Number(s.dataset.step) === current));
    }

    function reviewPanel(){
      const items = hasCart ? demoCart : [{name:'Sample Item', platform:'PC', qty:1, price:59.99}];
      const rows = items.map(it => `
        <tr><td>${it.name}</td><td>${it.platform||'—'}</td><td class="right">${it.qty||1}</td><td class="right">$${(it.price||0).toFixed(2)}</td></tr>
      `).join('');
      return `
        <div class="pad">
          <h2 style="margin:0 0 8px">Order Review</h2>
          <table>
            <thead><tr><th>Item</th><th>Platform</th><th class="right">Qty</th><th class="right">Price</th></tr></thead>
            <tbody>${rows}</tbody>
          </table>
          <div class="actions">
            <button class="btn btn-primary" id="toUser">Next: User Info</button>
          </div>
        </div>`;
    }

    function userPanel(){
      return `
      <div class="pad">
        <h2 style="margin:0 0 8px">User Information</h2>
        <div class="field"><label for="fullName">Full Name</label><input id="fullName" placeholder="Jane Player" /></div>
        <div class="field"><label for="email">Email</label><input id="email" type="email" placeholder="jane@example.com" /></div>
        <div class="field"><label for="address">Address</label><textarea id="address" rows="3" placeholder="Street, City, State, ZIP"></textarea></div>
        <div class="actions">
          <button class="btn btn-ghost" id="backReview">Back</button>
          <button class="btn btn-primary" id="toPayment">Next: Payment</button>
        </div>
      </div>`;
    }

    function paymentPanel(){
      return `
      <div class="pad">
        <h2 style="margin:0 0 8px">Payment Method</h2>
        <div class="field"><label for="cardName">Name on Card</label><input id="cardName" placeholder="Jane Player" /></div>
        <div class="field"><label for="cardNumber">Card Number</label><input id="cardNumber" inputmode="numeric" placeholder="4242 4242 4242 4242" /></div>
        <div style="display:grid;grid-template-columns:1fr 1fr; gap:12px">
          <div class="field"><label for="exp">Expiry</label><input id="exp" placeholder="MM/YY" /></div>
          <div class="field"><label for="cvc">CVC</label><input id="cvc" placeholder="123" /></div>
        </div>
        <div class="actions">
          <button class="btn btn-ghost" id="backUser">Back</button>
          <button class="btn btn-primary" id="toConfirm">Review & Confirm</button>
        </div>
      </div>`;
    }

    function confirmPanel(){
      return `
      <div class="pad">
        <h2 style="margin:0 0 8px">Confirmation</h2>
        <p class="muted">Review your details and place your order.</p>
        <ul class="muted" style="line-height:1.8">
          <li>Items: ${hasCart ? demoCart.length : 1}</li>
          <li>Email: <span id="confEmail">jane@example.com</span></li>
        </ul>
        <div class="actions">
          <button class="btn btn-ghost" id="backPayment">Back</button>
          <button class="btn btn-primary" id="placeOrder">Place Order</button>
        </div>
      </div>`;
    }

    const panel = document.getElementById('panel');
    const panelInner = document.getElementById('panelInner');
    function render(){
      setActive();
      if(current===1) panelInner.innerHTML = reviewPanel();
      if(current===2) panelInner.innerHTML = userPanel();
      if(current===3) panelInner.innerHTML = paymentPanel();
      if(current===4) panelInner.innerHTML = confirmPanel();

      // wire buttons
      const q = id => panelInner.querySelector('#'+id);
      q('toUser')?.addEventListener('click', ()=>{ current=2; render(); });
      q('backReview')?.addEventListener('click', ()=>{ current=1; render(); });
      q('toPayment')?.addEventListener('click', ()=>{ current=3; render(); });
      q('backUser')?.addEventListener('click', ()=>{ current=2; render(); });
      q('toConfirm')?.addEventListener('click', ()=>{ current=4; render(); });
      q('backPayment')?.addEventListener('click', ()=>{ current=3; render(); });
      q('placeOrder')?.addEventListener('click', ()=>{
        // demo success
        panelInner.innerHTML = `
          <div class="pad">
            <h2 style="margin:0 0 8px">Order Placed 🎉</h2>
            <p class="ok">Thanks! Your order is confirmed. A receipt was sent to your email.</p>
            <div class="actions"><a class="btn btn-primary" href="/products">Continue Shopping</a></div>
          </div>`;
        current = 4; setActive();
        localStorage.removeItem('cart');
        const cc = document.getElementById('cartCount'); if(cc) cc.textContent = 0;
      });
    }
    render();

    // cart badge
    const cartCount = (JSON.parse(localStorage.getItem('cart') || '[]')).length;
    document.getElementById('cartCount').textContent = cartCount;
  </script>
</body>
</html>

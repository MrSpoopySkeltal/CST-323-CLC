<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GameHub • Profile</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#0c0f1a; --bg2:#12172a; --text:#e8eefc; --muted:#9fb0c9; --card:#151b31; --outline:#2f3a5a; --accentA:#ff7a7a; --accentB:#49d3c3; }
  *{box-sizing:border-box}
  body{ margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--text);
        background: radial-gradient(1200px 800px at 20% -10%, #1a2241 0%, transparent 60%),
                   radial-gradient(900px 700px at 95% 30%, #152045 0%, transparent 55%),
                   linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%); }
  .nav{ position:sticky; top:0; z-index:20; backdrop-filter: blur(10px);
        background: linear-gradient(180deg, rgba(12,15,26,.9), rgba(12,15,26,.65));
        border-bottom:1px solid #1f2743; }
  .nav-inner{ max-width:1120px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; padding:14px 18px; }
  .brand{ font-weight:900; letter-spacing:.4px; font-size:26px; background:linear-gradient(90deg, var(--accentA), var(--accentB));
          -webkit-background-clip:text; background-clip:text; color:transparent; animation:pulse 2.6s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.02)} }
  .nav-links a{ color:#9fb0c9; text-decoration:none; margin-left:22px; font-weight:600; font-size:14px }
  .nav-links a:hover{ color:var(--text) }
  .wrap{ max-width:1120px; margin:42px auto 60px; padding:0 18px; }
  .title{ font-size: clamp(32px, 5vw, 48px); font-weight:900; text-align:center;
          background:linear-gradient(90deg, var(--accentA), var(--accentB));
          -webkit-background-clip:text; background-clip:text; color:transparent; margin:10px 0 8px; }
  .sub{ color:var(--muted); text-align:center; margin-bottom:24px }
  .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:18px }
  .card{ background: linear-gradient(180deg, #151b31, #131833); border:1px solid var(--outline); border-radius:16px; overflow:hidden }
  .pad{ padding:16px }
  .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:12px }
  label{ color:#c7d3ee; font-weight:700; font-size:12px; letter-spacing:.4px; text-transform:uppercase }
  input, select, textarea{ width:100%; background:#0e1429; color:var(--text); border:1px solid #2a3557; border-radius:10px; padding:10px 12px; outline:none; }
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; cursor:pointer; border:none; border-radius:999px; padding:12px 16px; font-weight:800; }
  .btn-primary{ background:linear-gradient(90deg, var(--accentA), var(--accentB)); color:#0b1227; }
  .btn-ghost{ background:transparent; color:#e8eefc; border:1px solid var(--outline); }
  .muted{ color:#9fb0c9 }
  ul.plain{ list-style:none; padding:0; margin:0 }
  li.cardish{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px; border:1px solid var(--outline); border-radius:12px; background:#121a32; margin:10px 0 }
</style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <a class="brand" th:href="@{/}">GameHub</a>
      <nav class="nav-links">
        <a th:href="@{/}">Home</a>
        <a th:href="@{/products}">Games</a>
        <a th:href="@{/about}">About</a>
        <a th:href="@{/cart}">Cart <span id="cartCount" th:text="${cartCount} ?: 0">0</span></a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <h1 class="title">Profile</h1>
    <p class="sub">Manage your account information and payment methods</p>

    <section class="grid">
      <!-- Manage Info -->
      <div class="card">
        <div class="pad">
          <h2 style="margin:0 0 10px">Manage Info</h2>
          <form th:action="@{/profile}" method="post">
            <div class="field"><label for="fullName">Full Name</label><input id="fullName" name="fullName" th:value="${user?.fullName}" placeholder="Jane Player" /></div>
            <div class="field"><label for="email">Email</label><input id="email" name="email" type="email" th:value="${user?.email}" placeholder="jane@example.com" /></div>
            <div class="field"><label for="address">Address</label><textarea id="address" name="address" rows="3" th:text="${user?.address}" placeholder="Street, City, State, ZIP"></textarea></div>
            <div style="display:flex; gap:10px; justify-content:flex-end">
              <button class="btn btn-primary" type="submit">Save Changes</button>
            </div>
          </form>
          <p class="muted" style="margin-top:10px" th:if="${saved}">Changes saved successfully.</p>
        </div>
      </div>

      <!-- Payment Methods -->
      <div class="card">
        <div class="pad">
          <h2 style="margin:0 0 10px">Payment Methods</h2>
          <ul class="plain" id="pmList">
            <li class="cardish" th:each="pm : ${paymentMethods}">
              <div>
                <div><strong th:text="${pm.brand} ?: 'Visa'">Visa</strong> •••• <span th:text="${pm.last4} ?: '4242'">4242</span></div>
                <div class="muted" style="font-size:13px">Exp <span th:text="${pm.exp} ?: '08/28'">08/28</span></div>
              </div>
              <div style="display:flex; gap:8px">
                <form th:action="@{|/profile/payment/${pm.id}/default|}" method="post"><button class="btn btn-ghost" type="submit">Make Default</button></form>
                <form th:action="@{|/profile/payment/${pm.id}/remove|}" method="post"><button class="btn btn-ghost" type="submit">Remove</button></form>
              </div>
            </li>
            <!-- Fallback demo -->
            <li class="cardish" th:if="${paymentMethods == null}">
              <div><strong>Visa</strong> •••• 4242 <div class="muted" style="font-size:13px">Exp 08/28</div></div>
              <div style="display:flex; gap:8px"><button class="btn btn-ghost">Make Default</button><button class="btn btn-ghost">Remove</button></div>
            </li>
          </ul>

          <hr style="border-color:#2a3557; opacity:.5; margin:14px 0">
          <form th:action="@{/profile/payment}" method="post">
            <div class="field"><label for="brand">Card Brand</label><select id="brand" name="brand"><option>Visa</option><option>Mastercard</option><option>Amex</option></select></div>
            <div class="field"><label for="last4">Last 4</label><input id="last4" name="last4" maxlength="4" placeholder="4242" /></div>
            <div class="field"><label for="exp">Expiry (MM/YY)</label><input id="exp" name="exp" placeholder="08/28" /></div>
            <div style="display:flex; gap:10px; justify-content:flex-end">
              <button class="btn btn-primary" type="submit">Add Payment Method</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <script>
    document.getElementById('cartCount').textContent = (JSON.parse(localStorage.getItem('cart')||'[]')).length;
  </script>
</body>
</html>
